require __DIR__ . '/../../config.php';
require __DIR__ . '/../..' . APP_PATH . '/vendor/autoload.php';

file_put_contents(__DIR__ . '/../../phirecms.zip', fopen('http://updates.phirecms.org/releases/phire/phirecms.zip', 'r'));
$basePath = realpath(__DIR__ . '/../../');
$archive  = new \Pop\Archive\Archive($basePath . '/phirecms.zip');
$archive->extract($basePath);

unlink(__DIR__ . '/../../phirecms.zip');
rename(__DIR__ . '/../..' . APP_PATH, __DIR__ . '/../..' . APP_PATH . '-' . time());
rename(__DIR__ . '/../../phire-cms-new', __DIR__ . '/../..' . APP_PATH);

header('Location: ' . BASE_PATH . APP_URI . '/update?update=2');
